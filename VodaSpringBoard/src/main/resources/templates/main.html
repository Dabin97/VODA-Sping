<!DOCTYPE html>
<html lang="ko"  xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VODA Main</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/bxslider/4.2.12/jquery.bxslider.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/bxslider/4.2.12/jquery.bxslider.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/bxslider/4.2.12/jquery.bxslider.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/bxslider/4.2.12/jquery.bxslider.min.js"></script>

   <style>
        * {
        margin: 0;
        padding: 0;
        background-color: black;
        color: white;
      }
      .flex_container{
          width: 1200px;
          margin: 0 auto;
          display: flex;
          flex-direction: column;
          position: relative;
      }
      
      .bx-wrapper{
        margin:0 100px;
        border: none;
        box-shadow: none;
      }
      .bx-prev{
        left: -40px !important;
      }
      .bx-next{
        right: -40px !important;
      }
      header{
        padding-top: 20px;
      }
      header img{
        width: 100px;
        padding-left: 100px;
        margin-top: 10px;
      }
    header input{
        position: absolute;
        margin-top: 10px;
        right: 0;
        background-color: rgb(34, 34, 34);
        border: none;
    }
    header a{
        padding-left: 20px;
        text-decoration: none;
    }
    .login{
        padding-left: 290px;
    }
    footer{
    width: 1200px;
    height: 80px;
    position: fixed ;
    bottom: 0;
    margin: 0 auto;
    text-align: center;
    }
    footer img{
        width: 40px;
        background-color: rgba(0, 0, 0, 0);
        height: 40px;
        margin: 20px 80px;
    }
    footer a{
        margin-right: 30px;
        padding: 10px;
        margin-top: 30px;
        text-decoration: none;
        color: rgb(168, 168, 168);
    }
      .top{
        position: fixed;
        width: 50px;
        height: 50px;
        background-image: url(img/up-arrow.png);
        background-size: 100%;
        background-repeat: no-repeat;
        bottom: 20px;
        right: 200px;
        border-radius: 100px;
      }
      .space{
        width: 100%;
        height: 100px;
        position: absolute;
      }
      .zoom{
        height: 40px;
        width: 300px;
        box-sizing: border-box;
        outline: none;
        background-image: url(img/zoom_white.png);
        background-repeat: no-repeat;
        background-size: 30px;
        background-position: 5px center;
        padding-left: 43px;
    }
    article{
        margin: 20px 0px 50px 0px;
        padding: 10px;
    }
    article > h1, article > h2{
        font-size: 32px;
        margin-bottom: 20px;
        margin-left: 100px;
    }
    .thumnail img{
        width: 300px;
        height: 350px;
    }
    .heart{
        position: absolute;
        right: 0;
        width: 30px !important;
        height: 30px !important;
        background-color: rgba(255, 255, 255, 0);
    }
    ul{
        list-style: none;
        color: white;
    }

    .hide {
        display: none !important;
        }

    .rel_search {
        position: absolute;
        right: 110px;
        z-index: 6;
        margin-top: 50px;
        float: right;
        border: 1px solid gray;
        color: white;
        width: 300px;
        height: 150px;
        overflow: auto;
        box-sizing: border-box;
        }
    
    .search_input{
        color: white;
        position: absolute;
        right: 110px;
        /* bottom: 150px; */
    }

    .pop_rel_keywords {
        list-style: none;
        margin-right: 50px;
        }

    .pop_rel_keywords > li {
        line-height : 250%
        }

    .rel_search::-webkit-scrollbar {
     display: none;
   }
   .slider > div > img{
        width: 100%;
        height: 500px;
    }
    .bx-wrapper{
        border: none;
        box-shadow: none;
    }
    .poster{
        position: relative;
    }
    .poster_logo{
        position: absolute;
        background-color: rgba(0, 0, 0, 0);
        width: 250px;
        height: 100px;
        display: inline-block; 
        top: 30px;
        left: 50px;
    }
    .poster_story{
        position: absolute;
        top: 150px;
        left: 50px;
        width: 400px;
        font-size: 13px;
        color: #e9e9ee;
        background-color: rgba(0, 0, 0, 0);
    }
    .comments{
        position: absolute;
        background-color: rgba(0, 0, 0, 0);
        top: 240px;
        left: 50px;
    }
    .comments img{
        width: 20px;
        background-color: rgba(0, 0, 0, 0);
        display: inline-block;
    }
    .star{
        display: flex;
    }
    .comments p{
        background-color: rgba(0, 0, 0, 0);
        display: inline-block;
        font-size: 20px;
        font-weight: bold;
    }
    h1 img{
        width: 30px;
        height: 30px;
    }
    .content_box{
        background-color: rgb(34, 34, 34);
        width: 600px;
        margin-left: 100px;
        margin-bottom: 30px;
        display: flex;
        flex-direction: row;
    }

    .best_poster{
        width: 300px;
        margin: 15px 50px 15px 15px;
    }
     
    .explanation{
        background-color: rgb(34, 34, 34);
        padding-top: 15px;
    }
    .explanation p, .explanation span{
        background-color: rgba(255, 255, 255,0);
    }
    .ex_title{
        font-size: 24px;
        font-weight: bold;
        padding-bottom: 20px;
    }
    .explanation img{ /*좋아요싫어요 이미지*/
        width: 20px;
        height: 20px;
        float: right;
        top: 0;
        background-color: rgba(255, 255,255,0);
        padding-bottom: 10px;
    }

    .best_review{
        background-color: rgba(255, 255,255,0);
        border: 1px solid rgb(73, 73, 73);
        border-radius: 10px;
        padding: 15px;
        width: 280px;
        height: 50px;
        margin-bottom: 20px;
        margin-right: 20px;
    }
    .dislike{
        margin-top: 7px;
    }
    .up_down{
        padding: 0px 5px;
        display: flex;
        float: right;
        top: 0;
        right: 0;
    }
    .review_content{
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    .mini{
        width: calc(100%/3);
        height: calc(100%/3);  
        font-size: 13px;
    }
    .mini_box{
        display: flex;
        flex-direction: row;
        /* background-color: rgb(34, 34, 34); */
        /* border: 1px solid rgb(73, 73, 73); */
        box-sizing: border-box;
    }
    .mini_poster{
        width: 90px;
        height: 100px;
        margin: 15px 30px 16px 15px;
    }
    .mini_explanation{
        /* background-color: rgb(34, 34, 34); */
        padding-top: 15px;
        padding-right: 10px;
        font-size: 13px;
        /* width: 250px; */
    }
    .mini_explanation p{
        background-color: rgba(255, 255, 255,0);
    }
    .mini_explanation p:nth-child(2){
        font-weight: bold;
        font-size: 20px;
    }
    .mini_explanation span{
        background-color: rgba(255, 255, 255,0);
        padding-top: 16px;
        font-size: 20px;
    }
    .mini_explanation img{
        width: 20px;
        height: 20px;
        padding-top: 20px;
        /* background-color: rgb(34, 34, 34); */
    }
    .click, .click img{
        background-color: rgb(34, 34, 34);;
    }
    </style>
    <script>
       $(function(){
        $('.slider').bxSlider({
            infiniteLoop : true,
            useCSS : true,
        });

        $('.new_end_search').bxSlider({
          pager : false,
          slideWidth : 400,
          useCSS : true,
          slideMargin: 20,
          minSlides:4,
          maxSlides:4,
          moveSlides:1,
          touchEnabled : false
        });
        
        $('.mini_poster').click(function(){ //mini_poster만 반영되는것
            console.log($(this).attr('src'));
            $('.best_poster').prop('src',$(this).attr('src'));
        });

        $('.heart').on({ //하트 이미지 변경
        'click': function() {
            var src = ($(this).attr('src') === 'img/heart_full.png')
                ? 'img/heart.png'
                : 'img/heart_full.png';
            $(this).attr('src', src);
            }
        });

        $('.like').on({ //like 이미지 변경
        'click': function() {
            var src = ($(this).attr('src') == 'img/like_full.png')
                ? 'img/like.png'
                : 'img/like_full.png';
            $(this).attr('src', src);
            }
        });

        $('.dislike').on({ //dislike 이미지 변경
        'click': function() {
            var src = ($(this).attr('src') == 'img/dislike_full.png')
                ? 'img/dislike.png'
                : 'img/dislike_full.png';
            $(this).attr('src', src);
            }
        });

        //연관검색어
        const ul = document.querySelector(".pop_rel_keywords");
        const searchInput = document.querySelector(".search_input");
        const relContainer = document.querySelector(".rel_search");
        let cache = '';


        const checkInput = () => {
            const beforeInput = searchInput.value;
            timer(beforeInput);
        }


        const timer = (beforeInput) => {
        setTimeout(() => {

            if(searchInput.value === beforeInput) {
            // console.log("입력멈춤");
            loadData(searchInput.value);
            checkInput();
            
            } else {
            // console.log("입력변함");
            checkInput();
            }
        
            if(searchInput.value === "") {
            relContainer.classList.add("hide");
            } else {
            relContainer.classList.remove("hide");
            }
        }, 500);
        }
  


        const loadData = (input) => {
        const url = `https://completion.amazon.com/api/2017/suggestions?session-id=135-3077052-6015425&customer-id=&request-id=DMRETXPQ3PZJQ5TKYSWX&page-type=Gateway&lop=en_US&site-variant=desktop&client-info=amazon-search-ui&mid=ATVPDKIKX0DER&alias=aps&b2b=0&fresh=0&ks=undefined&prefix=${input}&event=onFocusWithSearchTerm&limit=11&fb=1&suggestion-type=KEYWORD&suggestion-type=WIDGET&_=1615280967091`;
        
        if(cache === url) return;
        else {
        cache = url;
        fetch(url)
        .then((res) => res.json())
        .then(res => fillSearch(res.suggestions))
        }
        }

        const fillSearch = (suggestArr) => {
        ul.innerHTML = "";
        suggestArr.forEach((el, idx) => {
            const li = document.createElement("li");
            li.innerHTML = el.value;
            ul.appendChild(li);
        }) 
            
        const liList = document.querySelectorAll(".pop_rel_keywords li");
        }

        const highlightText = () => {
        }
        checkInput();
        
        // 요구사항 1 - esc를 누르면 추천 검색어 창이 닫여야 합니다.
        $(document).keydown(function(e){
            var code = e.keyCode || e.which;
        
            if (code == 27) {
                $('.rel_search').hide();
                location.reload();
            }
        });
        
      });
    </script> 
</head>
<body>
    <div class="flex_container">
        <header>
            <img src="img/VODA_logo.png" alt="">
            <a href="main_page.html">BEST</a>
            <a href="new_expire.html">NEW/EXPIRE</a>
            <a href="search.html">ALL</a>
            <a href="/" class="login">LOGIN</a>
            <input type="text" placeholder="search" class= "search_input zoom" >
                <container class = "rel_search">
                    <ul class="pop_rel_keywords"></ul>
                </container>
        </header>
        <div class="main_container">
        <section>
            <article>
                <div class="slider">
                    <div class="poster" th:each="board : ${list}">
                        <img th:src="[[${board.poster}]]" alt=""> <!--이미지 경로를 받아오기-->
                       <p class="poster_story">[[${board.content}]]</p>
                        <div class="comments">
                            <p class="star">
                                <img src="img/green_star_full.png" alt=""> <!--해당 컨텐츠에 해당하는 별점 이미지로 변경해야함-->
                                <img src="img/green_star.png" alt="">
                                <img src="img/green_star.png" alt="">
                                <img src="img/green_star.png" alt="">
                                <img src="img/green_star.png" alt="">
                                <p style="padding-left: 20px;">[[${board.review_content}]]</p> 
                                <!--th:each="board : ${list}" board list안에 review_content를 넣어서 each문에서 같이 뽑아야함. 따라서 ${board.review_content}-->
                            </p>
                            <br>
                            <p class="star">
                                <img src="img/green_star_full.png" alt="">
                                <img src="img/green_star_full.png" alt="">
                                <img src="img/green_star_full.png" alt="">
                                <img src="img/green_star_full.png" alt="">
                                <img src="img/green_star_full.png" alt="">
                                <p style="padding-left: 20px;">[[${review.review_content}]]</p>
                            </p>
                        </div>
                        <a th:href="@{/detail/{bno}(bno=${board.bno})}">[[${board.poster}]]</a>
                    </div>
            </article>

            <article>
            <h1>
                <img src="img/Union-left.png" alt="">BEST REVIEW<img src="img/Union-right.png" alt="">
            </h1>
            <div class="content_box">
                <img src="img/더 랍스터.png" alt="" class="best_poster"> 
                <div class="explanation">
                    <p>BEST 01</p>
                    <p class="ex_title">더 랍스터(The Lobster)</p>
                    <div class="best_review">
                        <p class="up_down">
                            <img src="img/dislike_full.png" class="dislike">
                            <span>88</span>
                        </p>
                        <p class="up_down">
                            <img src="img/like_full.png" class="like">
                            <span>809</span>
                        </p>
                        <p class="star">
                            <img src="img/green_star_full.png" alt="">
                            <img src="img/green_star_full.png" alt="">
                            <img src="img/green_star_full.png" alt="">
                            <img src="img/green_star_full.png" alt="">
                            <img src="img/green_star_full.png" alt="">
                            <span style="padding-left: 10px;">5.0</span>
                        </p>
                        <p class="review_content">
                            진정한 '(타인을 위하는) 감정'이라는것이 있는 것인지, 냉소적인 감독의 시선들이 곳곳에서 눈에 띄어서 오히려 나중에는 사랑을 떠나 인간본성에 대해서 생각을 하게 되었던 영화
                            의외로 보고 나왔던 직후, 생각나는 것은 우라사와 나오키의 만화 '몬스터'와 같이 인간본성에 대한 작품이었습니다
                            사랑에 관한 영화인 것처럼 포스터는 말하고 있지만 그것만은 아니라는 생각이 드네요
                        </p>
                    </div>
                    <div class="best_review">
                        <p class="up_down">
                            <img src="img/dislike_full.png" class="dislike">
                            <span>88</span>
                        </p>
                        <p class="up_down">
                            <img src="img/like_full.png" class="like">
                            <span>809</span>
                        </p>
                        <p class="star">
                            <img src="img/green_star_full.png" alt="">
                            <img src="img/green_star_full.png" alt="">
                            <img src="img/green_star_full.png" alt="">
                            <img src="img/green_star_full.png" alt="">
                            <img src="img/green_star_full.png" alt="">
                            <span style="padding-left: 10px;">5.0</span>
                        </p>
                        <p class="review_content">
                            진정한 '(타인을 위하는) 감정'이라는것이 있는 것인지, 냉소적인 감독의 시선들이 곳곳에서 눈에 띄어서 오히려 나중에는 사랑을 떠나 인간본성에 대해서 생각을 하게 되었던 영화
                            의외로 보고 나왔던 직후, 생각나는 것은 우라사와 나오키의 만화 '몬스터'와 같이 인간본성에 대한 작품이었습니다
                            사랑에 관한 영화인 것처럼 포스터는 말하고 있지만 그것만은 아니라는 생각이 드네요
                        </p>
                    </div>
                </div>
            <!--여기부터 미니박스 시작-->
                <div>
                    <div class="mini_box click" th:each="board : ${list}">
                        <img th:src="[[${board.poster}]]" alt="best_poster_mini" class="mini_poster"> <!--포스터 이미지 경로를 어떻게 이어야하는지?-->
                        <div class="mini_explanation click">
                            <p>BEST 01</p>
                            <p>[[${board.title}]]</p>
                            <p class="star mini">
                                <img src="img/green_star_full.png" alt="">
                                <img src="img/green_star_full.png" alt="">
                                <img src="img/green_star_full.png" alt="">
                                <img src="img/green_star_full.png" alt="">
                                <img src="img/green_star_full.png" alt="">
                                <span style="padding-left: 10px;">[[${star.count}]]</span> <!--별점 숫자가 테이블에 없는거같음, 테이블로 추가해야하는지 아니면 따로 메소드로 별점을 계산해서 넣어야하는지..-->
                            </p>
                        </div>  
                    </div>  
                    <!--이 아래로 2개더 미니박스가 추가되어야함-->
                </div>
            </div>
           

            </article>

            <article>
                <h2>NEW</h2>
                <div class="thumnail new_end_search" >
                    <div th:each="board : ${list}"> <!--신작만료작만 담은 list를 따로 만들어야할것같음-->
                        <img src="img/heart.png" class="heart">
                        <img src="[[${board.poster}]]" > <!--신작용 포스터만 보이게..-->
                    </div>
                </div>
            </article>
            <article>
                <h2>EXPIRE</h2>
                <div class="thumnail new_end_search">
                    <div th:each="board : ${list}">
                        <img src="img/heart.png" class="heart">
                        <img src="[[${board.poster}]]" > <!--신작용 포스터만 보이게..-->
                    </div>
                </div>
            </article>
            <a href="#top" class="top"></a>
            <div class="space"></div>
        </section>
        </div>
        <footer>
            <a href="/main"><img src="img/home.png"></a>
            <a href="/newexpire"><img src="img/video.png"></a>
            <a href="/search"><img src="img/explore.png"></a>
            <a href="/mypage"><img src="img/profile.png"></a>
        </footer>
    </div>
</body>
</html> 